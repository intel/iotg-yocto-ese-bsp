From d08950603607abf0b40303190c571d13fe57cf04 Mon Sep 17 00:00:00 2001
From: "Dillibabu, Karthikx" <karthikx.dillibabu@intel.com>
Date: Tue, 9 Feb 2021 13:59:19 +0530
Subject: [PATCH 1/1] HSDES ID : 1508635943

Fix: SPI 25MHZ data improper issue

Signed-off-by: Dillibabu, Karthikx <karthikx.dillibabu@intel.com>
---
 drivers/spi/spi-dw.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/drivers/spi/spi-dw.c b/drivers/spi/spi-dw.c
index 3bdfc6847fc7..d329df4e897a 100644
--- a/drivers/spi/spi-dw.c
+++ b/drivers/spi/spi-dw.c
@@ -220,6 +220,15 @@ static void dw_writer(struct dw_spi *dws)
 
 	spin_lock(&dws->buf_lock);
 	max = tx_max(dws);
+	/*
+	 * For higher frequencies greater than 20Mhz,
+	 * data read is inconsistent. Sometimes all 0's 
+	 * or all ff's are read, instead of expected data.
+	 * Adding a delay of 10us as a workaround is helping
+	 * to fix this issue to provide consistently expected data.
+	 */
+	if (dws->current_freq > 20000000)
+		udelay(10);
 	while (max--) {
 		/* Set the tx word if the transfer's original "tx" is not null */
 		if (dws->tx_end - dws->len) {
-- 
2.17.1

