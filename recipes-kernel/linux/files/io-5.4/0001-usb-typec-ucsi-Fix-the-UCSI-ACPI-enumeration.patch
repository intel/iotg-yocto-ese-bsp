From 9dce0c70afc261fc99f2b4d6ebf6cee204125913 Mon Sep 17 00:00:00 2001
From: Ramya P Karanth <ramya.p.karanth@intel.com>
Date: Tue, 8 Sep 2020 20:55:52 +0530
Subject: [PATCH 1/1] usb: typec: ucsi: Fix the UCSI ACPI enumeration

UCSI was not getting reprobed after loading Eclite driver

Signed-off-by: Ramya P Karanth <ramya.p.karanth@intel.com>
---
 drivers/usb/typec/ucsi/ucsi_acpi.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/drivers/usb/typec/ucsi/ucsi_acpi.c b/drivers/usb/typec/ucsi/ucsi_acpi.c
index 9a418ab68546..eb3bf0d7c10e 100644
--- a/drivers/usb/typec/ucsi/ucsi_acpi.c
+++ b/drivers/usb/typec/ucsi/ucsi_acpi.c
@@ -115,11 +115,15 @@ static void ucsi_acpi_notify(acpi_handle handle, u32 event, void *data)
 
 static int ucsi_acpi_probe(struct platform_device *pdev)
 {
+	struct acpi_device *adev = ACPI_COMPANION(&pdev->dev);
 	struct ucsi_acpi *ua;
 	struct resource *res;
 	acpi_status status;
 	int ret;
 
+	if (adev->dep_unmet)
+		return -EPROBE_DEFER;
+
 	ua = devm_kzalloc(&pdev->dev, sizeof(*ua), GFP_KERNEL);
 	if (!ua)
 		return -ENOMEM;
-- 
2.17.1

