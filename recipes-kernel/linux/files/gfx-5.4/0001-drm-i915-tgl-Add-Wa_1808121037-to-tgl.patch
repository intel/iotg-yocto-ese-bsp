From eb55ca9d9b8c1d68f99d48805ca536aa6d1e77fd Mon Sep 17 00:00:00 2001
From: "Sodhi, Vunny" <vunny.sodhi@intel.com>
Date: Tue, 18 Feb 2020 09:44:34 +0800
Subject: [PATCH] drm/i915/tgl: Add Wa_1808121037 to tgl.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

It's not clear whether this workaround is final yet, but the BSpec
indicates that userspace needs to set bit 9 of this register on demand:

   "To avoid sporadic corruptions â€œSet 0x7010[9] when Depth Buffer
   Surface Format is D16_UNORM , surface type is not NULL & 1X_MSAA"

BugLink: https://gitlab.freedesktop.org/mesa/mesa/issues/2501
Signed-off-by: Rafael Antognolli <rafael.antognolli@intel.com>
Reviewed-by: Matt Roper <matthew.d.roper@intel.com>
---
 drivers/gpu/drm/i915/gt/intel_workarounds.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/gpu/drm/i915/gt/intel_workarounds.c b/drivers/gpu/drm/i915/gt/intel_workarounds.c
index 129bc134374c..673379c6a8c2 100644
--- a/drivers/gpu/drm/i915/gt/intel_workarounds.c
+++ b/drivers/gpu/drm/i915/gt/intel_workarounds.c
@@ -1261,6 +1261,12 @@ static void tgl_whitelist_build(struct intel_engine_cs *engine)
 
 		/* WaEnablePreemptionGranularityControlByUMD:tgl */
 		whitelist_reg(w, GEN8_CS_CHICKEN1);
+
+		/* Wa_1808121037:tgl
+		 *
+		 * Allow userpace to implement this workaround.
+		 */
+		whitelist_reg(w, GEN7_COMMON_SLICE_CHICKEN1);
 		break;
 	default:
 		break;
-- 
2.24.0

